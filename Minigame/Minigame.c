#include "MiniGame.h"
#include <stdio.h>
#include <conio.h>
#include <time.h>
#include <windows.h>

#pragma execution_character_set("utf-8")

void gotoxy(int x, int y) {
    COORD pos = { x, y };
    SetConsoleCursorPosition(GetStdHandle(STD_OUTPUT_HANDLE), pos);
}

int TimeGame() {
    SetConsoleOutputCP(CP_UTF8);
    SetConsoleCP(CP_UTF8);

    // ===============================
    // ì•„ìŠ¤í‚¤ ì•„íŠ¸ ì¶œë ¥
    // ===============================
    system("cls");
    printAscii("asset/timegame.txt");
    Sleep(2500);
    system("cls");

    // ===============================
    // ë©”ì¸ í™”ë©´ (ë¯¼ì§„ ë²„ì „ ë ˆì´ì•„ì›ƒ)
    // ===============================
    printf("â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\n");
    printf("                        TIME ATTACK!                         \n");
    printf("                 10ì´ˆì— ìµœëŒ€í•œ ê°€ê¹ê²Œ ë©ˆì¶°ë¼!               \n");
    printf("                                                               \n");
    printf("              ìŠ¤íŽ˜ì´ìŠ¤ë°”ë¥¼ ëˆ„ë¥´ë©´ íƒ€ì´ë¨¸ê°€ ë©ˆì¶¥ë‹ˆë‹¤        \n");
    printf("â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n");
    printf("\n               ì¤€ë¹„ë˜ë©´ ì•„ë¬´ í‚¤ë‚˜ ëˆ„ë¥´ì„¸ìš”...\n");

    _getch();

    system("cls");

    printf("ðŸ”¥ íƒ€ì´ë¨¸ ì‹œìž‘!\n");
    printf("\n\n\n");
    printf("                           START!\n");
    printf("\n\n\n");
    Sleep(700);
    system("cls");

    // ===============================
    // íƒ€ì´ë¨¸ HUD
    // ===============================
    printf("â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\n");
    printf("                         ì‹¤ì‹œê°„ íƒ€ì´ë¨¸                        \n");
    printf("                                                               \n");
    printf("              ìŠ¤íŽ˜ì´ìŠ¤ë°”ë¥¼ ëˆ„ë¥´ë©´ íƒ€ì´ë¨¸ê°€ ë©ˆì¶¥ë‹ˆë‹¤            \n");
    printf("â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n");

    FILE* timer = fopen("asset/timer.txt", "r");
		char timerprint[100];
		while (fgets(timerprint, sizeof(timerprint), timer)) {
			printf("%s", timerprint);
		}
		fclose(timer);

    
    // ì´ˆê¸° ì‹œê°„ í‘œì‹œ ì œê±°
    clock_t start = clock();


    // ===============================
    // íƒ€ì´ë¨¸ ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸
    // ===============================
    while (1) {
        if (_kbhit()) {
            if (_getch() == ' ')
                break;
        }

        clock_t now = clock();
        double elapsed = (double)(now - start) / CLOCKS_PER_SEC;

        // ì»¤ì„œë¥¼ "â± í˜„ìž¬ ì‹œê°„:" ìžˆëŠ” ì¤„ë¡œ ì´ë™ì‹œì¼œ í•œ ì¤„ë§Œ ì—…ë°ì´íŠ¸
        gotoxy(13, 10);
        printf("%5.2f", elapsed);

        Sleep(10);
    }

    // ===============================
    // ê²°ê³¼ ê³„ì‚°
    // ===============================
    system("cls");
    double result = (double)(clock() - start) / CLOCKS_PER_SEC;


     //  ì—¬ê¸°ë§Œ ìˆ˜ì •ë¨ â€” ì„±ê³µ/ì‹¤íŒ¨ return ì¶”ê°€
if (result >= 9.90 && result <= 10.10) {
        printf("ðŸŽ‰ ì„±ê³µ! ì •í™•í•©ë‹ˆë‹¤!\n");
        return 1;   // ì„±ê³µ ë°˜í™˜

    printf("â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\n");
    printf("                           ê²°ê³¼ í™”ë©´                           \n");
    printf("--------------------------------------------------------------\n");
    printf("                       ë‹¹ì‹ ì˜ ê¸°ë¡ : %.2fì´ˆ                     \n", result);
    printf("--------------------------------------------------------------\n");

    // ===============================
    // ì„±ê³µ / ì‹¤íŒ¨ íŒì •
    // ===============================
    if (result >= 9.90 && result <= 10.10) {
        printf("                  ì„±ê³µ! ì •í™•í•œ íƒ€ì´ë°ìž…ë‹ˆë‹¤!                   \n");
        printf("                  ì•„ì´í…œ ë³´ìƒì„ íšë“í•©ë‹ˆë‹¤.                    \n");
        printf("â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n");

        printAscii("asset/itemsuccess.txt");
        Sleep(2500);
        
        return 1;

    }
    else {
        printf("                  ì‹¤íŒ¨! ë‹¤ì‹œ ë„ì „í•´ë³´ì„¸ìš”!                     \n");
        printf("               ì •í™•ë„ Â±0.10ì´ˆ ì´ë‚´ì—¬ì•¼ ì„±ê³µìž…ë‹ˆë‹¤              \n");
        printf("â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n");

        printAscii("asset/itemfail.txt");
        Sleep(2500);

        return 0;
    }
}
}

